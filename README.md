# Cimit : Application Current Limit

[![License](https://img.shields.io/badge/license-Apache%202-4EB1BA.svg)](https://www.apache.org/licenses/LICENSE-2.0.html)
[![Author](https://img.shields.io/badge/Author-PinuoC-67C23A.svg)](https://caohangwei.cn/)

## ä»‹ç»
é¢å¯¹é«˜å¹¶å‘é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬ä¸€èˆ¬æœ‰ä¸‰ç§åº”å¯¹ç­–ç•¥ï¼Œç¼“å­˜ã€é™çº§å’Œé™æµã€‚å½“ç³»ç»Ÿçš„èµ„æºé‡ä¸è¶³ä»¥å“åº”è¯·æ±‚é‡æ—¶ï¼Œå¤§é‡çš„è¯·æ±‚è®¿é—®ä¼šå¯¼è‡´ç³»ç»Ÿç›´æ¥è¢«å‹å®ï¼Œä¸ºäº†ä¿è¯æœ‰é™çš„èµ„æºèƒ½å¤Ÿæ­£å¸¸æœåŠ¡ï¼ŒåŒæ—¶å°½å¯èƒ½æå‡ç³»ç»Ÿçš„ååé‡ï¼Œé‚£ä¹ˆé™æµå°±æ˜¯ä¸€ä¸ªé‡è¦çš„æ‰‹æ®µã€‚

Cimit å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **è‡ªå®šä¹‰è§„åˆ™**ï¼šé’ˆå¯¹ä¸åŒçš„ä¸´ç•Œèµ„æºï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸åŒçš„é™æµè§„åˆ™ã€‚
- **æ¼æ¡¶ç®—æ³•**ï¼šæ¼æ¡¶ç®—æ³• (Leaky Bucket) èƒ½å¤Ÿå¼ºè¡Œé™åˆ¶æµé‡çš„ä¼ è¾“é€Ÿç‡ï¼Œå¹³æ»‘ç½‘ç»œçš„çªå‘æµé‡ã€‚
- **ç»†ç²’åº¦**ï¼šèƒ½å¤Ÿå¾ˆå¥½çš„é€‚åº”ä¸šåŠ¡ä»£ç ã€‚
- **æ³¨è§£**ï¼šä¸€ä¸ªæ³¨è§£è½»æ¾æå®šã€‚

## å¿«é€Ÿå¼€å§‹

### 1. æ³¨è§£æ–¹å¼

æ³¨è§£ `@Cimit` å®šä¹‰äº†ä¸€ä¸ªé™æµå™¨ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹å±æ€§ï¼š
- `value`: é™æµå™¨åç§°ã€‚è¿™æ˜¯ä¸€ä¸ªå”¯ä¸€å±æ€§ï¼Œé€šè¿‡ç»™æ–¹æ³•è®¾ç½®ä¸åŒçš„åç§°æ¥åˆ›å»ºå¤šä¸ªé™æµå™¨ã€‚ï¼ˆæ³¨æ„ï¼šä½¿ç”¨ç›¸åŒåç§°çš„æ³¨è§£ä¼šå…±äº«åŒä¸€ä¸ªé™æµå™¨è§„åˆ™ï¼‰
- `capacity`: é™æµå™¨æœ€å¤§æ¡¶å®¹é‡ã€‚æ­¤å±æ€§å¯ä»¥é™åˆ¶æœ€å¤§è¯·æ±‚æ•°é‡ï¼Œè¶…è¿‡å®¹é‡çš„è¯·æ±‚å°†ç›´æ¥æ‹’ç»ã€‚
- `rate`: é™æµå™¨å“åº”é€Ÿåº¦ã€‚è§„å®šäº†é™æµå™¨å•ä½æ—¶é—´å†…èƒ½å¤Ÿå¤„ç†è¯·æ±‚çš„æ•°é‡ã€‚
- `period`: é™æµå™¨å“åº”æ—¶é—´ã€‚è‡ªå®šä¹‰å“åº”æ—¶é—´ã€‚
- `timeUnit`: é™æµå™¨å“åº”æ—¶é—´å•ä½ã€‚å¯ä»¥æ”¯æŒçº³ç§’çº§åˆ«ä»¥ä¸Šçš„æ—¶é—´å•ä½ã€‚
- `waiting`: é™æµå™¨æ‹’ç»ç­–ç•¥ã€‚é»˜è®¤è¯·æ±‚ç›´æ¥æ‹’ç»ï¼Œé€šè¿‡è®¾ç½®ä¸º true å˜ä¸ºç­‰å¾…ç­–ç•¥ã€‚

ä¾‹å­ï¼š

æ·»åŠ  Spring AOP é…ç½®ï¼š
```java
@Configuration
public class CimitAspectConfiguration {

    @Bean
    public CimitAspect cimitAspect() {
        return new CimitAspect();
    }
}
```

æ·»åŠ æ³¨è§£ `@Cimit`ï¼š
```java
@Cimit(value = "Cimit", capacity = 1000, rate = 100, period = 1, timeUnit = TimeUnit.SECONDS)
public void example() {
    System.out.println("Hello Cimit!");
}
```
### 2. æ‰‹åŠ¨åˆ›å»º
è‡ªå®šä¹‰è§„åˆ™ï¼š
```java
LimiterRule rule = new LimiterRule("Cimit",1000,1000,1, TimeUnit.SECONDS);
```
é€šè¿‡ `LimiterFactory` å·¥å‚åˆ›å»ºç›¸åº”çš„é™æµå™¨ï¼š
``` java
LeakyBucketLimiter limiter = (LeakyBucketLimiter) LimiterFactory.getLeakyBucketLimiter(rule);
```

è¯¥é™æµå™¨æœ‰ä¸¤ç§æ–¹æ³• `tryAcquire` å’Œ `acquire`ï¼Œ`tryAcquire` å°†ä¼šå°è¯•å»å¾€æ¼æ¡¶ä¸­æ·»åŠ æ°´ï¼ˆæµé‡ï¼‰ï¼Œå¦‚æœæ¡¶çš„å‰©ä½™æµé‡ä¸è¶³ä¾¿ä¼šè¿”å› falseã€‚
``` java
if (limiter.tryAcquire()) {
    System.out.println("Hello Cimit!");
}
```

è€Œ `acquire` æ–¹æ³•åˆ™ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¯·æ±‚æˆåŠŸä¸ºæ­¢ã€‚

``` java
if (limiter.acquire()) {
    System.out.println("Hello Cimit!");
}
```

## å¾…åŠäº‹é¡¹

- [x] ~~æ³¨è§£åŠŸèƒ½~~
- [ ] åˆ†å¸ƒå¼é™æµ
- [ ] é™çº§ç­–ç•¥
- [ ] æ‰‹åŠ¨å¼€å…³
- [ ] å®æ—¶ç›‘æ§

## å…³äºä½œè€…

åšå®¢ï¼šhttps://caohangwei.cn/

å¦‚æœä½ è§‰å¾—æœ¬é¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’ star ç»™ä½œè€…ä¸€ç‚¹ç‚¹é¼“åŠ±ï¼Œè°¢è°¢ ğŸ˜„